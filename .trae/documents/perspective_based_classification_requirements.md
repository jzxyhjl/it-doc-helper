# 需求文档：基于视角的文档分类系统

## 介绍

将文档"类型"概念降级为"视角"，允许用户根据文档内容特征选择不同的处理视角。视角作为默认推荐和UI初始状态，用户可以切换视角来获得不同的处理结果。

## 需求 1 - 视角识别机制（主视角+次视角）

### 用户故事：
作为用户，我希望系统能够根据文档内容特征自动推荐合适的处理视角，对于包含多种特征的文档，系统应当识别主视角和次视角。

### 验收标准：
1. When 文档上传时，系统应当分析文档内容特征，推荐主视角和次视角
2. When 文档是 Q&A 结构时，系统应当推荐"面试题视角"（主或次）
3. When 文档强调系统组件关系时，系统应当推荐"架构视角"（主或次）
4. When 文档强调使用流程时，系统应当推荐"教程视角"（主或次）
5. When 文档同时包含多种明显特征时，系统应当标记一个主推荐视角，并提示一个或多个可选视角（次视角）
6. When 无法确定特征时，系统应当推荐默认视角（教程视角）作为主视角
7. When 文档是"强双视角文档"时，系统应当识别两个主视角，并允许用户选择任一视角处理

## 需求 2 - 视角切换功能（快速切换，复用中间结果）

### 用户故事：
作为用户，我希望能够在处理文档时选择不同的视角，并且切换视角时能够快速获得结果，而不需要重新全量处理。

### 验收标准：
1. When 用户上传文档时，系统应当显示推荐的主视角和可选次视角
2. When 用户选择不同视角时，系统应当复用已有的中间结果（内容提取、段落切分等）
3. When 用户切换视角时，系统应当在5秒内返回结果（复用中间结果，仅重新处理AI部分）
4. When 用户未选择视角时，系统应当使用推荐的主视角
5. When 处理完成后，系统应当保存用户选择的视角
6. When 用户切换视角时，系统应当显示"正在切换视角..."提示，避免用户以为是bug
7. When 中间结果不可用时，系统应当全量处理，但明确告知用户预计等待时间

## 需求 3 - 视角作为UI初始状态

### 用户故事：
作为用户，我希望在UI中看到推荐的视角作为初始状态，而不是固定的类型标签。

### 验收标准：
1. When 用户查看文档结果时，UI应当显示当前使用的视角
2. When 用户查看历史记录时，UI应当显示文档使用的视角
3. When 用户查看推荐文档时，UI应当显示推荐的视角
4. When 视角信息缺失时，UI应当显示默认视角（教程视角）

## 需求 4 - 降低类型权重

### 用户故事：
作为系统，我希望将"类型"概念降级为内部处理标识，不再作为用户可见的主要分类。

### 验收标准：
1. When 系统内部处理时，类型信息应当保留用于兼容性
2. When 用户界面显示时，应当优先显示视角信息
3. When API返回结果时，应当包含视角信息
4. When 数据库存储时，应当同时保存类型和视角信息

## 需求 5 - 视角识别算法（主次视角）

### 用户故事：
作为系统，我希望使用新的识别算法来判断文档适合的主视角和次视角。

### 验收标准：
1. When 文档包含 Q&A 结构（问题-答案对）时，系统应当识别为"面试题视角"（主或次）
2. When 文档强调系统组件、模块、服务关系时，系统应当识别为"架构视角"（主或次）
3. When 文档强调使用流程、操作步骤、教程内容时，系统应当识别为"教程视角"（主或次）
4. When 文档同时包含多种明显特征时，系统应当：
   - 选择得分最高的特征作为主视角
   - 选择得分次高的特征作为次视角（如果得分 >= 0.3）
   - 返回主视角和次视角列表
5. When 文档是"强双视角文档"（两个视角得分都 >= 0.5）时，系统应当标记两个主视角
6. When 视角得分差异 < 0.2 时，系统应当提示用户可以选择任一视角

## 需求 6 - 向后兼容性

### 用户故事：
作为系统，我希望保持向后兼容，确保现有功能不受影响。

### 验收标准：
1. When 处理历史文档时，系统应当能够根据类型推断默认视角
2. When API调用未指定视角时，系统应当使用推荐的视角
3. When 数据库查询时，系统应当能够同时支持类型和视角筛选
4. When 前端显示时，系统应当能够处理缺少视角信息的旧数据

## 视角定义

### 面试题视角（interview）
- **识别特征**：Q&A 结构、问题-答案对、选择题、问答题
- **处理方式**：使用 InterviewProcessor
- **输出结构**：summary, generated_questions, extracted_answers

### 架构视角（architecture）
- **识别特征**：系统组件关系、模块依赖、服务架构、部署配置
- **处理方式**：使用 ArchitectureProcessor
- **输出结构**：config_steps, components, architecture_view, plain_explanation, checklist, related_technologies

### 教程视角（technical）
- **识别特征**：使用流程、操作步骤、学习路径、入门指南
- **处理方式**：使用 TechnicalProcessor
- **输出结构**：prerequisites, learning_path, learning_methods, related_technologies

## 优先级

- **P0**：需求1（视角识别机制-主次视角）、需求2（视角切换功能-快速切换）
- **P0.5**：需求5（视角识别算法-主次视角识别，文档包含多种特征时标记主推荐视角并提示可选视角）
- **P1**：需求3（UI初始状态）、需求4（降低类型权重）
- **P2**：需求6（向后兼容性）

## 重要设计决策

### 1. 强双视角文档支持
- 系统需要识别并支持"强双视角文档"
- 用户可以选择任一主视角进行处理
- UI需要清晰展示主视角和次视角

### 2. 视角切换成本优化
- **核心原则**：切换视角不应让用户等待超过5秒
- **实现方式**：复用中间结果（内容提取、段落切分、预处理等）
- **仅重新处理**：AI处理部分（根据视角调用不同的处理器）
- **用户体验**：显示明确的切换提示，避免用户以为是bug

### 3. 处理结果结构
- **不需要统一结构**：各视角保持其独特的输出结构
- **不应该统一结构**：不同视角的输出结构反映了不同的处理逻辑和用户需求
- **前端适配**：前端根据视角选择对应的展示组件

## 技术约束

1. 保持现有数据库结构，新增 perspective 字段
2. 保持现有API接口，新增 perspective 参数
3. 保持现有处理器逻辑，通过视角映射到处理器
4. 前端UI需要支持视角切换组件

