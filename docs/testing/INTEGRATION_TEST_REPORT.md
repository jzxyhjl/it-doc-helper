# 集成测试报告

## 测试目标

验证可信度估计、来源引用、异常处理和失败策略功能的完整性和正确性。

## 测试环境

- 后端服务: `http://localhost:8000`
- 前端服务: `http://localhost/it-doc-helper`
- 测试时间: 2025-12-12

## 测试用例

### 1. 服务健康检查

**测试步骤：**
1. 检查后端服务健康状态
2. 检查前端服务可访问性

**预期结果：**
- 后端服务返回 `{"status": "healthy"}`
- 前端服务可正常访问

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 2. 文档上传和大小验证

**测试步骤：**
1. 上传正常大小的文档（< 20MB）
2. 验证文件大小检查功能
3. 验证上传响应包含 `document_id`

**预期结果：**
- 上传成功，返回 `document_id`
- 文件大小在限制范围内
- 如果文件 > 20MB，显示警告但不阻止

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 3. 文档处理流程

**测试步骤：**
1. 上传文档后等待处理完成
2. 检查处理状态变化（pending -> running -> completed）
3. 验证处理时间在合理范围内

**预期结果：**
- 处理状态正确流转
- 处理时间 < 300秒（5分钟）
- 处理完成后状态为 `completed`

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 4. 处理结果结构验证

**测试步骤：**
1. 获取处理结果
2. 检查结果包含必需字段：
   - `document_type`
   - `result`
   - `processing_time`
3. 检查结果数据结构完整性

**预期结果：**
- 所有必需字段存在
- 结果数据结构正确
- 处理时间字段为整数

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 5. 可信度和来源字段验证

**测试步骤：**
1. 检查结果中是否包含 `confidence` 字段
2. 检查结果中是否包含 `sources` 字段
3. 验证可信度值在 0-100 范围内
4. 验证来源片段格式正确

**预期结果：**
- 结果包含 `confidence` 字段（数值或标签）
- 结果包含 `sources` 字段（数组格式）
- 可信度值有效
- 来源片段包含 `id` 和 `text` 字段

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 6. 失败状态处理

**测试步骤：**
1. 检查失败状态的处理（failed/timeout/low_quality）
2. 验证失败时返回错误信息
3. 验证失败状态不会返回无效结果

**预期结果：**
- 失败状态正确标记
- 失败时返回明确的错误信息
- 不会返回空结果或无效结果

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 7. 异常场景测试

#### 7.1 无效文件上传

**测试步骤：**
1. 尝试上传无效文件（如空文件、损坏文件）
2. 验证系统正确拒绝

**预期结果：**
- 无效文件被拒绝
- 返回明确的错误信息
- 不会创建文档记录

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

#### 7.2 不存在的文档查询

**测试步骤：**
1. 使用不存在的文档ID查询结果
2. 验证返回404状态码

**预期结果：**
- 返回HTTP 404状态码
- 返回明确的错误信息

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

#### 7.3 超大文件处理

**测试步骤：**
1. 尝试上传超过30MB的文件
2. 验证文件大小限制

**预期结果：**
- 文件被拒绝
- 返回明确的错误信息
- 建议拆分文档

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 8. 前端展示验证

**测试步骤：**
1. 访问前端页面
2. 上传文档并查看处理结果
3. 验证可信度标签显示
4. 验证来源片段显示
5. 验证弱展示模式（面试题/架构文档）

**预期结果：**
- 前端页面正常加载
- 可信度标签正确显示（高/中/低）
- 来源片段可展开查看
- 弱展示模式默认隐藏，可点击展开

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 9. 边界情况测试

#### 9.1 超长段落处理

**测试步骤：**
1. 上传包含超长段落的文档（> 2000字符）
2. 验证段落切分功能

**预期结果：**
- 超长段落被正确切分
- 切分后的段落长度合理
- 来源引用正确

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

#### 9.2 无来源结果处理

**测试步骤：**
1. 处理无法找到来源的结果
2. 验证系统处理方式

**预期结果：**
- 系统优雅处理无来源情况
- 不显示来源片段或显示提示

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

#### 9.3 低可信度结果处理

**测试步骤：**
1. 处理可信度 < 40 的结果
2. 验证低可信度标签显示

**预期结果：**
- 低可信度正确标记
- 标签颜色为红色
- 用户可以看到警告

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

### 10. 兜底逻辑测试

**测试步骤：**
1. 模拟段落切分失败
2. 模拟可信度计算失败
3. 模拟AI返回格式错误
4. 验证系统降级处理

**预期结果：**
- 异常情况下系统不崩溃
- 使用兜底策略继续处理
- 记录详细的错误日志

**实际结果：**
- [ ] 通过
- [ ] 失败

**备注：**

---

## 测试总结

### 测试统计

- 总测试用例数: 10
- 通过数: 0
- 失败数: 0
- 跳过数: 0

### 发现的问题

1. **问题描述：**
   - 严重程度：[高/中/低]
   - 状态：[待修复/已修复/已知问题]

### 建议

1. 
2. 
3. 

---

## 测试执行记录

### 执行时间
- 开始时间: 
- 结束时间: 
- 总耗时: 

### 测试人员
- 执行人: 
- 审核人: 

### 环境信息
- Docker版本: 
- Python版本: 
- Node版本: 

---

**测试报告生成时间：** 2025-12-12

