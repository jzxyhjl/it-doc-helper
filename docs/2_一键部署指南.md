# ä¸€é”®éƒ¨ç½²æŒ‡å—

## âœ… ç³»ç»Ÿå·²å®Œå…¨å®¹å™¨åŒ–ï¼Œæ”¯æŒä¸€é”®éƒ¨ç½²

æœ¬ç³»ç»Ÿä½¿ç”¨ Docker å’Œ Docker Compose è¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ‰€æœ‰æœåŠ¡ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€åç«¯ã€å‰ç«¯ï¼‰éƒ½å·²å°è£…åœ¨ Docker å®¹å™¨ä¸­ï¼Œ**æ— éœ€åœ¨ç›®æ ‡ç¯å¢ƒå®‰è£…ä»»ä½•é¢å¤–è½¯ä»¶**ï¼ˆé™¤äº† Docker æœ¬èº«ï¼‰ã€‚

## ğŸ“‹ ç›®æ ‡ç¯å¢ƒåŸºç¡€è®¾æ–½è¦æ±‚

### å¿…éœ€çš„åŸºç¡€è®¾æ–½

1. **Docker** (ç‰ˆæœ¬ 20.10+)
   - ç”¨äºè¿è¡Œå®¹å™¨
   - ä¸‹è½½åœ°å€ï¼šhttps://www.docker.com/get-started

2. **Docker Compose** (ç‰ˆæœ¬ 2.0+)
   - ç”¨äºç¼–æ’å¤šå®¹å™¨åº”ç”¨
   - é€šå¸¸éš Docker Desktop ä¸€èµ·å®‰è£…
   - æˆ–å•ç‹¬å®‰è£…ï¼šhttps://docs.docker.com/compose/install/

3. **ç½‘ç»œè¿æ¥**
   - ç”¨äºä¸‹è½½ Docker é•œåƒ
   - ç”¨äºè®¿é—® DeepSeek APIï¼ˆAIåŠŸèƒ½ï¼‰

4. **ç³»ç»Ÿèµ„æºè¦æ±‚**
   - **CPU**: 2æ ¸å¿ƒä»¥ä¸Šï¼ˆæ¨è4æ ¸å¿ƒ+ï¼‰
   - **å†…å­˜**: 4GBä»¥ä¸Šï¼ˆæ¨è8GB+ï¼‰
     - PostgreSQL: ~512MB
     - Redis: ~128MB
     - åç«¯æœåŠ¡: ~1GB
     - Celery Worker: ~1GB
     - å‰ç«¯æœåŠ¡: ~128MB
     - ç³»ç»Ÿé¢„ç•™: ~1GB
   - **ç£ç›˜ç©ºé—´**: 10GBä»¥ä¸Šï¼ˆç”¨äºé•œåƒã€æ•°æ®ã€ä¸Šä¼ æ–‡ä»¶ï¼‰
   - **æ“ä½œç³»ç»Ÿ**: 
     - Linux (Ubuntu 20.04+, CentOS 7+, Debian 10+)
     - macOS 10.15+
     - Windows 10/11 (ä½¿ç”¨ Docker Desktop)

### å¯é€‰çš„åŸºç¡€è®¾æ–½

- **åŸŸåå’ŒSSLè¯ä¹¦**ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
- **åå‘ä»£ç†**ï¼ˆå¦‚ Nginxï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰
- **ç›‘æ§å·¥å…·**ï¼ˆå¦‚ Prometheus, Grafanaï¼‰

## ğŸš€ ä¸€é”®éƒ¨ç½²æ­¥éª¤

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd it-doc-helper
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè‡³å°‘é…ç½®ä»¥ä¸‹å¿…éœ€é¡¹ï¼š
#   - POSTGRES_PASSWORD: æ•°æ®åº“å¯†ç ï¼ˆå¿…å¡«ï¼‰
#   - DEEPSEEK_API_KEY: DeepSeek APIå¯†é’¥ï¼ˆå¿…å¡«ï¼Œç”¨äºAIåŠŸèƒ½ï¼‰
```

**`.env` æ–‡ä»¶ç¤ºä¾‹ï¼š**
```env
# æ•°æ®åº“é…ç½®
POSTGRES_DB=it_doc_helper
POSTGRES_USER=it_doc_helper
POSTGRES_PASSWORD=your_secure_password_here

# DeepSeek APIé…ç½®ï¼ˆå¿…å¡«ï¼‰
DEEPSEEK_API_KEY=sk-your-deepseek-api-key-here
DEEPSEEK_API_BASE=https://api.deepseek.com

# å¯é€‰é…ç½®
USE_LOCAL_EMBEDDING=true
EMBEDDING_MODEL_NAME=sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
UPLOAD_MAX_SIZE=31457280
LOG_LEVEL=INFO
```

### 3. ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker-compose logs -f
```

### 4. ç­‰å¾…æœåŠ¡å°±ç»ª

é¦–æ¬¡å¯åŠ¨éœ€è¦ï¼š
- ä¸‹è½½ Docker é•œåƒï¼ˆçº¦ 2-5 åˆ†é’Ÿï¼Œå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰
- æ„å»ºåº”ç”¨é•œåƒï¼ˆçº¦ 3-5 åˆ†é’Ÿï¼‰
- åˆå§‹åŒ–æ•°æ®åº“ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼Œçº¦ 10-30 ç§’ï¼‰

**æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š**
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# åº”è¯¥çœ‹åˆ°æ‰€æœ‰æœåŠ¡éƒ½æ˜¯ "Up" çŠ¶æ€ï¼š
# - it-doc-helper-postgres (healthy)
# - it-doc-helper-redis (healthy)
# - it-doc-helper-backend (running)
# - it-doc-helper-worker (running)
# - it-doc-helper-frontend (running)
```

### 5. è®¿é—®åº”ç”¨

- **å‰ç«¯ç•Œé¢**: http://localhost/it-doc-helper
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

## ğŸ“¦ ç³»ç»Ÿæ¶æ„

ç³»ç»ŸåŒ…å«ä»¥ä¸‹ Docker å®¹å™¨ï¼š

1. **PostgreSQLæ•°æ®åº“** (`it-doc-helper-postgres`)
   - é•œåƒ: `pgvector/pgvector:pg15`
   - ç«¯å£: 5432
   - æ•°æ®æŒä¹…åŒ–: Docker Volume `postgres_data`
   - åŠŸèƒ½: å­˜å‚¨æ–‡æ¡£ã€å¤„ç†ç»“æœã€å‘é‡æ•°æ®

2. **Redisç¼“å­˜** (`it-doc-helper-redis`)
   - é•œåƒ: `redis:7-alpine`
   - ç«¯å£: 6379
   - æ•°æ®æŒä¹…åŒ–: Docker Volume `redis_data`
   - åŠŸèƒ½: ä»»åŠ¡é˜Ÿåˆ—ã€ç¼“å­˜

3. **åç«¯APIæœåŠ¡** (`it-doc-helper-backend`)
   - é•œåƒ: è‡ªæ„å»ºï¼ˆåŸºäº `python:3.11-slim`ï¼‰
   - ç«¯å£: 8000
   - åŠŸèƒ½: RESTful APIã€æ–‡æ¡£å¤„ç†ã€AIé›†æˆ

4. **Celery Worker** (`it-doc-helper-worker`)
   - é•œåƒ: è‡ªæ„å»ºï¼ˆä¸åç«¯ç›¸åŒï¼‰
   - åŠŸèƒ½: å¼‚æ­¥æ–‡æ¡£å¤„ç†ä»»åŠ¡

5. **å‰ç«¯æœåŠ¡** (`it-doc-helper-frontend`)
   - é•œåƒ: è‡ªæ„å»ºï¼ˆåŸºäº `nginx:alpine`ï¼‰
   - ç«¯å£: 80
   - åŠŸèƒ½: Webç•Œé¢

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f worker
docker-compose logs -f postgres
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
```

### åœæ­¢æœåŠ¡
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡ï¼ˆä¿ç•™æ•°æ®ï¼‰
docker-compose stop

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨ï¼ˆä¿ç•™æ•°æ®å·ï¼‰
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰ï¼ˆåŒ…æ‹¬æ•°æ®å·ï¼Œè°¨æ…ä½¿ç”¨ï¼ï¼‰
docker-compose down -v
```

### æ›´æ–°ç³»ç»Ÿ
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose build
docker-compose up -d
```

### æŸ¥çœ‹èµ„æºä½¿ç”¨
```bash
docker stats
```

## ğŸ”’ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - ç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„ `POSTGRES_PASSWORD` æ˜¯å¼ºå¯†ç 
   - ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

2. **é…ç½®é˜²ç«å¢™**
   - åªå¼€æ”¾å¿…è¦çš„ç«¯å£ï¼ˆ80, 8000ï¼‰
   - é™åˆ¶æ•°æ®åº“å’ŒRedisçš„è®¿é—®ï¼ˆä»…å®¹å™¨å†…è®¿é—®ï¼‰

3. **ä½¿ç”¨HTTPS**
   - é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
   - ä½¿ç”¨SSLè¯ä¹¦

4. **å®šæœŸå¤‡ä»½**
   - å¤‡ä»½ PostgreSQL æ•°æ®å·
   - å¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆ`./uploads` ç›®å½•ï¼‰

## ğŸ“Š æ•°æ®æŒä¹…åŒ–

### âœ… Docker Volume å·²è‡ªåŠ¨é…ç½®

ç³»ç»Ÿä½¿ç”¨ Docker Volume æŒä¹…åŒ–æ•°æ®ï¼Œ**ä¸€é”®éƒ¨ç½²æ—¶è‡ªåŠ¨åˆ›å»ºå’Œä½¿ç”¨**ï¼š

1. **PostgreSQLæ•°æ®**: `postgres_data` (Docker Volume)
   - è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
   - æ•°æ®ä½ç½®: Docker ç®¡ç†çš„ Volume
   - æŸ¥çœ‹å‘½ä»¤: `docker volume inspect it-helper_postgres_data`

2. **Redisæ•°æ®**: `redis_data` (Docker Volume)
   - è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
   - æ•°æ®ä½ç½®: Docker ç®¡ç†çš„ Volume
   - æŸ¥çœ‹å‘½ä»¤: `docker volume inspect it-helper_redis_data`

3. **ä¸Šä¼ æ–‡ä»¶**: `./uploads` (ç»‘å®šæŒ‚è½½)
   - æŒ‚è½½åˆ°é¡¹ç›®ç›®å½•ä¸‹çš„ `uploads` æ–‡ä»¶å¤¹
   - å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»º

### ğŸ” æŸ¥çœ‹ Volume ä¿¡æ¯

```bash
# æŸ¥çœ‹æ‰€æœ‰ Volume
docker volume ls | grep it-doc-helper

# æŸ¥çœ‹ Volume è¯¦ç»†ä¿¡æ¯
docker volume inspect it-doc-helper_postgres_data
docker volume inspect it-doc-helper_redis_data

# æŸ¥çœ‹ Volume ä½¿ç”¨æƒ…å†µ
docker system df -v
```

### ğŸ’¾ å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½PostgreSQL
docker-compose exec postgres pg_dump -U it_doc_helper it_doc_helper > backup.sql

# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf uploads_backup.tar.gz ./uploads

# å¤‡ä»½æ•´ä¸ª Volumeï¼ˆå¯é€‰ï¼‰
docker run --rm -v it-doc-helper_postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_backup.tar.gz /data
```

### ğŸ—‘ï¸ åˆ é™¤ Volumeï¼ˆè°¨æ…æ“ä½œï¼‰

```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨å’Œæ•°æ®å·ï¼ˆæ•°æ®ä¼šä¸¢å¤±ï¼ï¼‰
docker-compose down -v

# åªåˆ é™¤ Volumeï¼ˆä¿ç•™å®¹å™¨é…ç½®ï¼‰
docker volume rm it-doc-helper_postgres_data it-doc-helper_redis_data
```

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

1. **æ£€æŸ¥ç«¯å£å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tuln | grep -E ':(80|8000|5432|6379)'
```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
```bash
docker-compose logs backend
docker-compose logs worker
```

3. **æ£€æŸ¥ç¯å¢ƒå˜é‡**
```bash
# ç¡®ä¿ .env æ–‡ä»¶å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
cat .env
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

1. **æ£€æŸ¥æ•°æ®åº“å®¹å™¨çŠ¶æ€**
```bash
docker-compose ps postgres
```

2. **æ£€æŸ¥æ•°æ®åº“æ—¥å¿—**
```bash
docker-compose logs postgres
```

3. **æ‰‹åŠ¨è¿æ¥æµ‹è¯•**
```bash
docker-compose exec postgres psql -U it_doc_helper -d it_doc_helper
```

### AIåŠŸèƒ½ä¸å·¥ä½œ

1. **æ£€æŸ¥APIå¯†é’¥**
```bash
# ç¡®ä¿ DEEPSEEK_API_KEY å·²é…ç½®
grep DEEPSEEK_API_KEY .env
```

2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
```bash
# æµ‹è¯•APIè¿æ¥
curl https://api.deepseek.com
```

## ğŸ“ æ€»ç»“

âœ… **ç³»ç»Ÿå·²å®Œå…¨å®¹å™¨åŒ–**ï¼Œæ‰€æœ‰ä¾èµ–éƒ½å°è£…åœ¨ Docker å®¹å™¨ä¸­

âœ… **ä¸€é”®éƒ¨ç½²**ï¼šåªéœ€ `docker-compose up -d` å³å¯å¯åŠ¨æ‰€æœ‰æœåŠ¡

âœ… **ç›®æ ‡ç¯å¢ƒè¦æ±‚æä½**ï¼š
   - åªéœ€å®‰è£… Docker å’Œ Docker Compose
   - æ— éœ€å®‰è£… PostgreSQLã€Redisã€Pythonã€Node.js ç­‰
   - æ‰€æœ‰æœåŠ¡è‡ªåŠ¨é…ç½®å’Œåˆå§‹åŒ–

âœ… **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ Docker Volumeï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±

âœ… **æ˜“äºè¿ç§»**ï¼šæ•´ä¸ªç³»ç»Ÿå¯ä»¥è½»æ¾è¿ç§»åˆ°ä»»ä½•æ”¯æŒ Docker çš„ç¯å¢ƒ

---

**æœ€åæ›´æ–°**: 2024-12-12

