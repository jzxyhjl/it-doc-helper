# 系统测试文档

## 测试环境

### 服务状态
- ✅ **后端API**: http://localhost:8000 (运行中)
- ✅ **前端服务（生产）**: http://localhost/it-doc-helper (运行中)
- ✅ **前端服务（开发）**: http://localhost:5173/it-doc-helper (运行中)
- ✅ **PostgreSQL**: 容器运行中 (healthy)
- ✅ **Redis**: 容器运行中 (healthy)
- ✅ **Celery Worker**: 容器运行中

## 测试流程

### 1. 文档上传测试

**测试文件**: 支持 PDF, DOCX, PPTX, MD, TXT 格式，最大30MB
- ⚠️ **注意**：暂不支持旧版 Word 文档（.doc），请先转换为 .docx 格式

**上传结果**:
```json
{
  "document_id": "...",
  "task_id": "...",
  "filename": "...",
  "file_size": 851,
  "file_type": "md",
  "status": "pending"
}
```

**状态**: ✅ 上传成功

### 2. 文档处理流程

**处理步骤**:
1. ✅ 文档内容提取 (0-20%)
2. ✅ 文档类型识别 (20-40%)
   - 识别类型: `interview` / `technical` / `architecture`
3. ✅ AI处理文档 (40-90%)
   - 使用 DeepSeek API 处理
4. ✅ 保存处理结果 (90-100%)

### 3. 处理进度查询

**API**: `GET /api/v1/documents/{document_id}/progress`

**响应示例**:
```json
{
  "document_id": "...",
  "progress": 60,
  "current_stage": "处理技术文档...",
  "status": "running"
}
```

### 4. 处理结果查询

**API**: `GET /api/v1/documents/{document_id}/result`

**响应**: 完整的处理结果（JSON格式）

## 功能验证

### 核心功能
- [x] 文档上传（支持PDF, DOCX, PPTX, MD, TXT）
- [x] 文档内容提取
- [x] 文档类型识别（interview, technical, architecture）
- [x] AI文档处理（DeepSeek API）
- [x] 实时进度显示
- [x] 处理结果展示
- [x] 历史记录查询
- [x] 智能推荐（合并了相似文档功能）

### 性能指标
- **文档上传响应**: < 1秒
- **内容提取时间**: < 1秒
- **类型识别时间**: < 1秒
- **AI处理时间**: 约60-80秒（取决于文档大小）
- **前端页面加载**: < 1秒
- **API响应时间**: < 500ms

## API测试命令

### 健康检查
```bash
curl http://localhost:8000/health
```

### 上传文档
```bash
curl -X POST http://localhost:8000/api/v1/documents/upload \
  -F "file=@test_document.md"
```

### 查看处理进度
```bash
curl http://localhost:8000/api/v1/documents/{document_id}/progress
```

### 查看处理结果
```bash
curl http://localhost:8000/api/v1/documents/{document_id}/result
```

### 查看历史记录
```bash
curl 'http://localhost:8000/api/v1/documents/history?page=1&page_size=5'
```

## 快速测试指南

### 1. 访问API文档

打开浏览器访问：
```
http://localhost:8000/docs
```

### 2. 测试文档上传

在API文档页面：
1. 找到 `POST /api/v1/documents/upload`
2. 点击 "Try it out"
3. 选择一个测试文件（PDF/Word/PPT/Markdown/TXT，<30MB）
4. 点击 "Execute"
5. 查看响应，获取 `document_id`

### 3. 查看处理进度

在API文档页面：
1. 找到 `GET /api/v1/documents/{document_id}/progress`
2. 输入刚才获取的 `document_id`
3. 点击 "Execute"
4. 查看处理进度

### 4. 查看处理结果

处理完成后（约30秒-2分钟）：
1. 找到 `GET /api/v1/documents/{document_id}/result`
2. 输入 `document_id`
3. 点击 "Execute"
4. 查看处理结果

## 命令行测试

### 健康检查
```bash
curl http://localhost:8000/health
```

### 查看历史记录
```bash
curl 'http://localhost:8000/api/v1/documents/history?page=1&page_size=5'
```

## 查看日志

```bash
# 后端日志
docker-compose logs -f backend

# Worker日志
docker-compose logs -f worker

# 所有服务日志
docker-compose logs -f
```

## 测试结果

### 文档类型识别测试

| 文档类型 | 测试文件 | 识别结果 | 状态 |
|---------|---------|---------|------|
| 面试题 | test_interview.md | interview | ✅ |
| 技术文档 | test_technical.md | technical | ✅ |
| 架构文档 | test_architecture.md | architecture | ✅ |

### 处理时间测试

| 文档大小 | 处理时间 | 状态 |
|---------|---------|------|
| < 100KB | 30-60秒 | ✅ |
| 100KB - 1MB | 60-90秒 | ✅ |
| 1MB - 5MB | 90-120秒 | ✅ |
| > 5MB | 120-180秒 | ✅ |

---

**最后更新**: 2024-12-12

